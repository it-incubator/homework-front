import { useAppDispatch } from '@/shared/hooks/useAppDispatch'
import { useEffect, useState } from 'react'
import { fetchUsersTC, selectUsers } from './model/users-slice'
import { useAppSelector } from '@/shared/hooks/useAppSelector'
import { TextField } from '@/homeworks/sprint-2/hw-7/TextField/TextField'

/*
 * üßô‚Äç‚ôÇÔ∏è –î–µ–±–∞—É–Ω—Å (debounce) - –≤–∞–∂–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
 * –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å –Ω–µ–π –≤ –¥–∞–Ω–Ω–æ–º –∑–∞–¥–∞–Ω–∏–∏.
 *
 * –ú—ã —Ä–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞.
 *
 * –û—Ç–∫—Ä–æ–π—Ç–µ Network –∏ –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ç–æ, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–æ–¥–µ —Å–∏–º–≤–æ–ª–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞,
 * –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –ï—Å–ª–∏ –º—ã –ø–µ—á–∞—Ç–∞–µ–º –±—ã—Å—Ç—Ä–æ, —Ç–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤.
 *
 * –≠—Ç–æ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
 *
 * –î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ö—É–∫ useDebounce.
 * –ï–≥–æ —Å—É—Ç—å –≤ —Ç–æ–º, —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –Ω–µ —á–∞—â–µ, —á–µ–º —É–∫–∞–∑–∞–Ω–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ delay.
 * –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–ø–∏—à–µ–º –ø–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å, —Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –≤–≤–æ–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∏–º–≤–æ–ª–∞.
 *
 * üìù 1. –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ö—É–∫–∞ useDebounce
 * - –î–∞–Ω–Ω—ã–π —Ö—É–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –∑–∞–¥–µ—Ä–∂–∫—É.
 *  ‚ùó –í –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ 500–º—Å - —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏—è
 * - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–æ—Å—å –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ
 * - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω—è–ª–æ—Å—å, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
 *
 * üìù 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö—É–∫ useDebounce –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
 *
 * üßô‚Äç‚ôÇÔ∏è –î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∞–º —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è `useEffect`, `setTimeout`, `clearTimeout`
 * üßô‚Äç‚ôÇÔ∏è –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞–π—Ç–∏ –≥–æ—Ç–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –Ω–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ç–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å –µ—ë —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (–ü–æ–¥–æ–±–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ —á–∞—Å—Ç–æ –¥–∞—ë—Ç—Å—è –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è—Ö).
 */

const DEBOUNCE_DELAY = 500

export const Homework17 = () => {
  const dispatch = useAppDispatch()
  const users = useAppSelector(selectUsers)

  const [name, setName] = useState('')
  // üìù –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö—É–∫ useDebounce –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

  useEffect(() => {
    dispatch(fetchUsersTC({ name }))
  }, [dispatch, name])

  return (
    <section id={'hw17'}>
      <h3>Homework 17 - Debounce</h3>
      <TextField id="hw17-input" label="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏" value={name} onChange={(e) => setName(e.target.value)} />
      <ul id="hw17-users">
        {users.map((user, index) => (
          <li key={user.id}>
            <span>{user.name}</span>
          </li>
        ))}
      </ul>
    </section>
  )
}

// üßô‚Äç‚ôÇÔ∏è –î–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Generic
export function useDebounce<T>(value: T, delay: number = DEBOUNCE_DELAY): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value)

  // üìù –ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

  return debouncedValue
}
